# データモデル

## Firestore

### profiles/{profileId}
- id: string
- displayName: string
- username: string（@なし、小文字保存）
- authUid: string（Firebase AuthのUID）
- beaconId: string
- bio: string
- homeTown: string
- favoriteGames: string[]
- avatarColor: number（ARGB）
- avatarImageBase64: string（任意）
- receivedLikes: number
- followersCount: number
- followingCount: number
- updatedAt: timestamp

#### profiles/{profileId}/followers/{authUid}
- profile: object（相手の簡易プロフィール）
- createdAt: timestamp

#### profiles/{profileId}/following/{targetId}
- profile: object（相手の簡易プロフィール）
- createdAt: timestamp

#### profiles/{profileId}/likes/{viewerId or authUid}
- profile: object（いいねした側の簡易プロフィール）
- viewerProfileId: string
- createdAt: timestamp

#### profiles/{profileId}/notifications/{notificationId}
- type: string（reply）
- fromUserId: string
- fromUserName: string
- fromUserUsername: string?
- fromUserAvatarBase64: string?
- fromUserColorValue: number
- postId: string
- replyId: string?
- caption: string
- createdAt: timestamp
- read: boolean

#### profiles/{profileId}/fcmTokens/{tokenHash}
- token: string
- platform: string（android/ios）
- createdAt: timestamp
- updatedAt: timestamp

### usernames/{username}
- profileId: string
- createdAt: timestamp

### streetpass_presences/{deviceId}
- profile: object（Profile.toMap相当）
- lat: number
- lng: number
- lastUpdatedMs: number（epoch ms）
- active: boolean
- message: string?（任意）

### timelinePosts/{postId}
- id: string
- authorId: string
- authorName: string
- authorUsername: string?
- authorColorValue: number
- authorAvatarImageBase64: string?
- caption: string
- createdAt: string or timestamp
- imageBase64: string?
- imageUrl: string?
- likeCount: number
- likedBy: string[]
- hashtags: string[]
- replyCount: number?（集計用）

#### timelinePosts/{postId}/replies/{replyId}
- id: string
- parentPostId: string
- replyToId: string?
- replyToAuthorName: string?
- authorId: string
- authorName: string
- authorUsername: string?
- authorColorValue: number
- authorAvatarImageBase64: string?
- caption: string
- createdAt: string or timestamp
- imageBase64: string?
- imageUrl: string?
- likeCount: number
- likedBy: string[]
- hashtags: string[]
- replyCount: number?（孫リプライ用）

### emotion_map_posts/{postId}
- id: string
- emotion: string（happy/sad/excited/calm/surprised/tired）
- latitude: number
- longitude: number
- createdAt: timestamp or string
- message: string?
- profileId: string

### conversations/{conversationId}
- participantIds: string[]
- unreadCounts: map（userId -> count）
- lastMessage: string?
- lastMessageAt: string or timestamp
- type: string（text）
- pinnedBy: map（userId -> bool）
- mutedBy: map（userId -> bool）

#### conversations/{conversationId}/messages/{messageId}
- id: string
- conversationId: string
- senderId: string
- text: string
- createdAt: string or timestamp
- readAt: string or timestamp?
- type: string（text/image）
- imageUrl: string?

## Firebase Storage
- `timelinePosts/{postId}.jpg`（投稿画像）
- `dm_images/{uuid}.jpg`（DM画像）

## ローカル保存（SharedPreferences）
- streetpass_device_id: string
- local_display_name / local_username / local_bio / local_home_town
- local_favorite_games: string[]
- local_avatar_color / local_avatar_image
- local_beacon_id
- local_followers_count / local_following_count

## 参照
- [[04_API・サービス]]
